@{
    @using System.Text
    @using ViewModels.HomePage
    @model HomePageViewModel
}
@section HeadBlock {
    <link rel="stylesheet" media="screen, print" href="~/css/fa-duotone.css">
}

<div class="container">
    <div class="row">
        <div class="col">
            <div id="panel-5" class="panel">
                <div class="panel-hdr">
                    <h2>
                        <span>What's on?</span>
                    </h2>
                    <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                    </div>
                </div>
                <div class="panel-container show">
                    <div class="panel-content">
                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-A.jpg" data-src="holder.js/800x400?auto=yes&bg=37e2d0&fg=ffffff&text=First slide" alt="First slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-B.jpg" data-src="holder.js/800x400?auto=yes&bg=21dfcb&fg=ffffff&text=Second slide" alt="Second slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-C.jpg" data-src="holder.js/800x400?auto=yes&bg=21dfcb&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-D.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-E.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-F.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-G.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-H.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-I.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-J.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="~/img/tp-banner-2023-05-K.jpg" data-src="holder.js/800x400?auto=yes&bg=1dc9b7&fg=ffffff&text=Third slide" alt="Third slide">
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="row">

        <div class="col-lg">
            <div id="panel-5" class="panel">
                <div class="panel-hdr">
                    <h2>
                        <span>Staff anniversaries</span>
                    </h2>
                    <div class="panel-toolbar">
                        <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                        <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                    </div>
                </div>
                <div class="panel-container show">
                    <div class="panel-content overflow-auto" style="height: 32rem;">
                        @if (Model.Anniversaries != null && Model.Anniversaries.Count() > 0)
                        {
                            @foreach (var card in Model.Anniversaries)
                            {
                                if (card.IsBirthday)
                                {
                                    bool publicCommentsAndLikes = card.ShowLikesAndComments == true || card.EmployeeID == Model.LoggedInEmployeeId ? true : false;
                                    bool privateCommentsAndLikes = card.ShowLikesAndComments == false && card.EmployeeID != Model.LoggedInEmployeeId ? true : false;
                                    bool publicComments = (card as EmployeesBirthdays).Comments.Count() > 0 && (card.ShowLikesAndComments == true || card.EmployeeID == Model.LoggedInEmployeeId) ? true : false;

                                    <div class="card mb-g">
                                        <div class="card-body pb-0 px-4" id="@(card.AnniversaryID + "birthdayCard")">
                                            <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0">
                                                <div class="d-inline-block align-middle status status-success mr-3">
                                                    @{ var profileImage = card.ImageBase64 != null ? card.ImageBase64 : "/img/demo/avatars/" + (Settings.Theme.Avatar);}
                                                    <span class="profile-image rounded-circle d-block" style="background-image:url('@(profileImage)'); background-size: cover;"></span>
                                                </div>
                                                <h5 class="mb-0 flex-1 text-dark fw-500">
                                                    @card.FirstName @card.LastName
                                                </h5>
                                                <span class="text-muted fs-xs opacity-70">
                                                    @{string daysInText = "";
                                                        int daysLeft = card.DaysLeft;

                                                        if (daysLeft == 0) { daysInText = "Today"; }
                                                        if (daysLeft > 0) { daysInText = $"{daysLeft} days"; }
                                                        if (daysLeft == 1) { daysInText = $"{daysLeft} day"; }
                                                        if (daysLeft < 0) { daysInText = $"{Math.Abs(daysLeft)} days ago"; }
                                                        if (daysLeft == -1) { daysInText = "Yesterday"; }
                                                    }
                                                    @daysInText
                                                </span>
                                            </div>
                                            <div class="pt-2 border-top-0 border-left-0 border-right-0 text-muted">
                                                @{ var date = new DateTime(DateTime.Now.Year, card.AnniversaryDate.Month, card.AnniversaryDate.Day);}
                                                <p>Happy Birthday to @card.FirstName (@date.ToString("dddd d MMMM"))</p>
                                            </div>
                                            @if (publicCommentsAndLikes)
                                            {
                                                var str = new StringBuilder();
                                                foreach (var like in (card as EmployeesBirthdays).Likes)
                                                {
                                                    str.AppendLine("<div>" + like.Employee.FirstName + " " + like.Employee.Surname + "</div>");
                                                }
                                                <div class="d-flex align-items-center demo-h-spacing py-3">
                                                    @if ((card as EmployeesBirthdays).Likes.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                    {
                                                        <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="event.preventDefault()" data-toggle="popover" data-trigger="hover" data-placement="right" title="" data-html="true" data-content="@str.ToString()">
                                                            <i class="@(Settings.Theme.IconPrefix) fad fa-heart fs-xs mr-1" style="color: red;"></i> <span>@((card as EmployeesBirthdays).Likes.Count()) Likes</span>
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a href="javascript:void(0);" onclick="sendLike(@card.AnniversaryID ,@Model.LoggedInEmployeeId, true)" class="d-inline-flex align-items-center text-dark" data-toggle="popover" data-trigger="hover" data-placement="right" title="" data-html="true" data-content="@str.ToString()">
                                                            <i class="@(Settings.Theme.IconPrefix) fa-heart fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "likes")">@((card as EmployeesBirthdays).Likes.Count()) Likes</span>
                                                        </a>
                                                    }

                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark">
                                                        <i class="@(Settings.Theme.IconPrefix) fa-comment fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "birthdayComments")">@((card as EmployeesBirthdays).Comments.Count()) Comments</span>
                                                    </a>
                                                </div>
                                            }
                                            @if (privateCommentsAndLikes)
                                            {
                                                @* IF NULL STILL GIVE THEM PERMISSION TO LIKE BUT ONLY ONCE   (NEED TO GET THE LIKES REGARDLESS OF THE PRIVACY) *@
                                                <div class="d-flex align-items-center demo-h-spacing py-3">
                                                    @if ((card as EmployeesBirthdays).Likes.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                    {
                                                        <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="event.preventDefault()">
                                                            <i class="@(Settings.Theme.IconPrefix) fad fa-heart fs-xs mr-1" style="color: red;"></i> <span> Liked</span>
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a href="javascript:void(0);" onclick="sendLike(@card.AnniversaryID ,@Model.LoggedInEmployeeId, true, false)" class="d-inline-flex align-items-center text-dark">
                                                            <i class="@(Settings.Theme.IconPrefix) fa-heart fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "likes")"> Like</span>
                                                        </a>
                                                    }

                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark">
                                                        <i class="@(Settings.Theme.IconPrefix) fa-comment fs-xs mr-1"></i> <span> Comments</span>
                                                    </a>
                                                </div>
                                            }
                                            @{var comments = (card as EmployeesBirthdays).Comments; }
                                            @if (publicComments)
                                            {
                                                <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="showAllCommentsForEntity(@card.AnniversaryID, true)">
                                                    <span class="font-weight-bold">Show all comments...</span>
                                                </a>
                                            }
                                            else
                                            {
                                                @if (comments.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                {
                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="showAllCommentsForEntity(@card.AnniversaryID, true)">
                                                        <span class="font-weight-bold">Show your comments...</span>
                                                    </a>
                                                    comments = comments.Where(x => x.EmployeeId == Model.LoggedInEmployeeId).ToList();
                                                }
                                            }
                                            <div id="@(card.AnniversaryID.ToString() + "hiddenBirthdayCommentsDiv")" style="display:none;">
                                                @foreach (var comment in comments)
                                                {
                                                    <div>
                                                        <hr />
                                                        <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0" style="margin-left: 2.5rem;">
                                                            <div class="d-inline-block align-middle status status-success mr-3">
                                                                @{ var profileImg = comment.Employee.ImageBase64 != null ? comment.Employee.ImageBase64 : "/img/demo/avatars/" + (Settings.Theme.Avatar);}
                                                                <span class="profile-image rounded-circle d-block" style="background-image:url('@(profileImg)'); background-size: cover;"></span>
                                                            </div>
                                                            <h6 class="mb-0 flex-1 text-dark fw-500" style="flex: none;">
                                                                @comment.Employee.FirstName @comment.Employee.Surname
                                                            </h6>
                                                            <span class="text-muted fs-xs opacity-70" style="margin-left: 6.5rem;">@comment.CreatedDateTime.ToString("dddd dd MMMM")</span>
                                                        </div>
                                                        <span style="margin-left: 2.5rem;">@comment.Content</span>
                                                    </div>
                                                }
                                            </div>

                                        </div>
                                        <div class="card-body py-0 px-4 border-faded border-right-0 border-bottom-0 border-left-0">
                                            <div class="d-flex flex-column align-items-center">
                                                <div class="py-3 w-100">
                                                    <textarea id="@(card.AnniversaryID.ToString() + "commentTextarea")" class="form-control border-0 p-0 bg-transparent" onclick="sendComment(@card.AnniversaryID, @Model.LoggedInEmployeeId, true)" rows="2" placeholder="add a comment..."></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                }
                                @* WORK ANNIVERSARIES *@
                                else
                                {
                                    bool publicCommentsAndLikes = card.ShowLikesAndComments == true || card.EmployeeID == Model.LoggedInEmployeeId ? true : false;
                                    bool privateCommentsAndLikes = card.ShowLikesAndComments == false && card.EmployeeID != Model.LoggedInEmployeeId ? true : false;
                                    bool publicComments = (card as EmployeesAnnivarsaries).Comments.Count() > 0 && (card.ShowLikesAndComments == true || card.EmployeeID == Model.LoggedInEmployeeId) ? true : false;

                                    <div class="card mb-g">
                                        <div class="card-body pb-0 px-4" id="@(card.AnniversaryID + "workCard")">
                                            <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0">
                                                <div class="d-inline-block align-middle status status-success mr-3">
                                                    @{ var profileImage = card.ImageBase64 != null ? card.ImageBase64 : "/img/demo/avatars/" + (Settings.Theme.Avatar);}
                                                    <span class="profile-image rounded-circle d-block" style="background-image:url('@profileImage'); background-size: cover;"></span>
                                                </div>
                                                <h5 class="mb-0 flex-1 text-dark fw-500">
                                                    @card.FirstName @card.LastName
                                                </h5>
                                                <span class="text-muted fs-xs opacity-70">
                                                    @{string daysInText = "";
                                                        int daysLeft = card.DaysLeft;

                                                        if (daysLeft == 0) { daysInText = "Today"; }
                                                        if (daysLeft > 0) { daysInText = $"{daysLeft} days"; }
                                                        if (daysLeft == 1) { daysInText = $"{daysLeft} day"; }
                                                        if (daysLeft < 0) { daysInText = $"{Math.Abs(daysLeft)} days ago"; }
                                                        if (daysLeft == -1) { daysInText = "Yesterday"; }
                                                    }
                                                    @daysInText
                                                </span>
                                            </div>
                                            <div class="pt-2 border-top-0 border-left-0 border-right-0 text-muted">
                                                @{
                                                    var date = new DateTime(DateTime.Now.Year, card.AnniversaryDate.Month, card.AnniversaryDate.Day);
                                                    int years = DateTime.Today.Year - card.AnniversaryDate.Year;
                                                    string yearsInText = "";
                                                    if (years == 1) { yearsInText = $"{years}st"; }
                                                    if (years == 2) { yearsInText = $"{years}nd"; }
                                                    if (years == 3) { yearsInText = $"{years}rd"; }
                                                    if (years >= 4) { yearsInText = $"{years}th"; }
                                                }
                                                <p>Happy @yearsInText year work anniversary to @card.FirstName (@date.ToString("dddd d MMMM"))</p>
                                            </div>
                                            @if (publicCommentsAndLikes)
                                            {
                                                var str = new StringBuilder();
                                                foreach (var like in (card as EmployeesAnnivarsaries).Likes)
                                                {
                                                    str.AppendLine("<div>" + like.Employee.FirstName + " " + like.Employee.Surname + "</div>");
                                                }
                                                <div class="d-flex align-items-center demo-h-spacing py-3">
                                                    @if ((card as EmployeesAnnivarsaries).Likes.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                    {
                                                        <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="event.preventDefault()" data-toggle="popover" data-trigger="hover" data-placement="right" title="" data-html="true" data-content="@str.ToString()">
                                                            <i class="@(Settings.Theme.IconPrefix) fad fa-heart fs-xs mr-1" style="color: red;"></i> <span>@((card as EmployeesAnnivarsaries).Likes.Count()) Likes</span>
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a href="javascript:void(0);" onclick="sendLike(@card.AnniversaryID ,@Model.LoggedInEmployeeId, false)" class="d-inline-flex align-items-center text-dark" data-toggle="popover" data-trigger="hover" data-placement="right" title="" data-html="true" data-content="@str.ToString()">
                                                            <i class="@(Settings.Theme.IconPrefix) fa-heart fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "workLikes")">@((card as EmployeesAnnivarsaries).Likes.Count()) Likes</span>
                                                        </a>
                                                    }
                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark">
                                                        <i class="@(Settings.Theme.IconPrefix) fa-comment fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "workComments")">@((card as EmployeesAnnivarsaries).Comments.Count()) Comments</span>
                                                    </a>
                                                </div>
                                            }
                                            @if (privateCommentsAndLikes)
                                            {
                                                <div class="d-flex align-items-center demo-h-spacing py-3">
                                                    @if ((card as EmployeesAnnivarsaries).Likes.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                    {
                                                        <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="event.preventDefault()">
                                                            <i class="@(Settings.Theme.IconPrefix) fad fa-heart fs-xs mr-1" style="color: red;"></i> <span> Liked</span>
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a href="javascript:void(0);" onclick="sendLike(@card.AnniversaryID ,@Model.LoggedInEmployeeId, false, false)" class="d-inline-flex align-items-center text-dark">
                                                            <i class="@(Settings.Theme.IconPrefix) fa-heart fs-xs mr-1"></i> <span id="@(card.AnniversaryID.ToString() + "likes")"> Like</span>
                                                        </a>
                                                    }

                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark">
                                                        <i class="@(Settings.Theme.IconPrefix) fa-comment fs-xs mr-1"></i> <span> Comments</span>
                                                    </a>
                                                </div>
                                            }
                                            @{var comments = (card as EmployeesAnnivarsaries).Comments; }
                                            @if (publicComments)
                                            {
                                                <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="showAllCommentsForEntity(@card.AnniversaryID, false)">
                                                    <span class="font-weight-bold">Show all comments...</span>
                                                </a>
                                            }
                                            else
                                            {
                                                @if (comments.FindIndex(x => x.EmployeeId == Model.LoggedInEmployeeId) >= 0)
                                                {
                                                    <a href="javascript:void(0);" class="d-inline-flex align-items-center text-dark" onclick="showAllCommentsForEntity(@card.AnniversaryID, false)">
                                                        <span class="font-weight-bold">Show your comments...</span>
                                                    </a>
                                                    comments = comments.Where(x => x.EmployeeId == Model.LoggedInEmployeeId).ToList();
                                                }
                                            }
                                            <div id="@(card.AnniversaryID.ToString() + "hiddenWorkCommentsDiv")" style="display:none;">
                                                @foreach (var comment in comments)
                                                {
                                                    <hr />
                                                    <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0" style="margin-left: 2.5rem;">
                                                        <div class="d-inline-block align-middle status status-success mr-3">
                                                            @{ var profileImg = comment.Employee.ImageBase64 != null ? comment.Employee.ImageBase64 : "/img/demo/avatars/" + (Settings.Theme.Avatar);}
                                                            <span class="profile-image rounded-circle d-block" style="background-image:url('@(profileImg)'); background-size: cover;"></span>
                                                        </div>
                                                        <h6 class="mb-0 flex-1 text-dark fw-500" style="flex: none;">
                                                            @comment.Employee.FirstName @comment.Employee.Surname
                                                        </h6>
                                                        <span class="text-muted fs-xs opacity-70" style="margin-left: 6.5rem;">@comment.CreatedDateTime.ToString("dddd dd MMMM")</span>
                                                    </div>
                                                    <span style="margin-left: 2.5rem;">@comment.Content</span>
                                                }
                                            </div>
                                        </div>
                                        @if ((card as EmployeesAnnivarsaries).Comments != null)
                                        {
                                            <div class="card-body py-0 px-4 border-faded border-right-0 border-bottom-0 border-left-0">
                                                <div class="d-flex flex-column align-items-center">
                                                    <div class="py-3 w-100">
                                                        <textarea id="@(card.AnniversaryID.ToString() + "workCommentTextarea")" class="form-control border-0 p-0 bg-transparent" rows="2" onclick="sendComment(@card.AnniversaryID, @Model.LoggedInEmployeeId, false)" placeholder="add a comment..."></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                            }
                        }
                        else
                        {
                            <div>There is no anniversaries coming in the next 2 weeks.</div>
                        }
                    </div>
                </div>
            </div>
        </div>

            <div class="col-lg">
                <div id="panel-5" class="panel">
                    <div class="panel-hdr">
                        <h2>
                            <span>Latest high 5's!</span>
                        </h2>
                        <div class="panel-toolbar">
                            <button class="btn btn-panel" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
                            <button class="btn btn-panel" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
                        </div>
                    </div>
                    <div class="panel-container show">
                        <div class="panel-content overflow-auto" style="height: 32rem;">
                            @if (Model.EmployeesHighFives != null && Model.EmployeesHighFives.Count > 0)
                            {
                                @foreach (var highFive in Model.EmployeesHighFives)
                                {
                                    <div class="card mb-g">
                                        <div class="card-body pb-0 px-4 rounded-sm">
                                            <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0">
                                                <div class="d-inline-block align-middle status status-success mr-3">
                                                    @{ var profileImage = highFive.ImageBase64 != null ? highFive.ImageBase64 : "/img/demo/avatars/" + (Settings.Theme.Avatar);}
                                                    <span class="profile-image rounded-circle d-block" style="background-image:url('@(profileImage)'); background-size: cover;"></span>
                                                </div>
                                                <h5 class="mb-0 flex-1 text-dark fw-500">@(highFive.FirstName + " " + highFive.LastName)</h5>
                                                <span class="text-muted fs-xs opacity-70">
                                                    @{string daysInText = "";
                                                        int daysLeft = (DateTime.Today - highFive.CreatedDateTime).Days;
                                                        if (daysLeft == 0) { daysInText = "Today"; }
                                                        if (daysLeft > 0) { daysInText = $"{daysLeft} days"; }
                                                        if (daysLeft == 1) { daysInText = $"{daysLeft} day"; }
                                                        if (daysLeft < 0) { daysInText = $"{Math.Abs(daysLeft)} days ago"; }
                                                        if (daysLeft == -1) { daysInText = "Yesterday"; }
                                                    }
                                                    @daysInText
                                                </span>
                                            </div>
                                            <div class="pb-3 pt-2 border-top-0 border-left-0 border-right-0 text-muted">
                                                <p>@highFive.Comment</p>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div>There was no high 5's found in past 2 weeks.</div>
                            }
                        </div>
                    </div>
                </div>
            </div>
       
    </div>
</div>

@section ScriptsBlock {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/holder/2.9.7/holder.min.js"></script>

    <script>
        function sendLike(entityId, loggedInEmpId, IsBirthday, showLikes = true) {
            var json = { entityWishId: entityId, empId: loggedInEmpId, IsBirthday: IsBirthday };

            var spanEl = '';
            if (IsBirthday) {
                spanEl = $(`#${entityId + "likes"}`); }
            else {
                spanEl = $(`#${entityId + "workLikes"}`);
            }

            var likeLink = spanEl.parent();
            likeLink.prop("onclick", null).off("click");

            $.ajax({
                url: "/api/anniversaries/",
                type: "POST",
                contentType: 'application/json',
                data: JSON.stringify(json),
                success: function (data) {

                    function animateLike(spanEl, likeLink) {
                        likeLink.children().first().css("color", "red").removeClass().addClass('fad fa-heart fs-xs mr-1');
                        if (showLikes) { spanEl.html(data.likesCount + " Likes"); }
                        else { spanEl.html(' Liked') }
                    }
                    animateLike(spanEl, likeLink);
                }
            });
        }

        function sendComment(entityId, loggedInEmpId, IsBirthday) {
            var commentField = null;
            var commentSpan = null;
            if (IsBirthday) {
                commentField = $(`#${entityId}commentTextarea`);
                commentSpan = $(`#${entityId}birthdayComments`);
            }
            else {
                commentField = $(`#${entityId}workCommentTextarea`);
                commentSpan = $(`#${entityId}workComments`);
            }


            commentField.on('keypress', function (e) {
                if (e.which == 13) {
                    commentField.off('keypress');
                    var comment = commentField.val();
                    //make sure only one comment can be added at a time
                    commentField.val('');
                    commentField.blur();
                    //alert(comment + ' '+ entityId);
                    if (comment.length > 0) {
                        var json = { entityWishId: entityId, empId: loggedInEmpId, IsBirthday: IsBirthday, Content: comment };
                        $.ajax({
                            url: "/api/anniversaries/insertcomment",
                            type: "POST",
                            data: JSON.stringify(json),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (data) {
                                // insert the new comment and update the comments count
                                var comment = createNewComment(data.image, data.firstName, data.lastName, data.formattedDate, data.content);
                                var commentsCount = data.commentsCount;

                                commentSpan.html(commentsCount + " Comments");
                                //var cardBody = commentField.parents().parents().parents().parents();
                                var cardBodyDiv = '';
                                if (IsBirthday) { cardBodyDiv = $(`#${entityId}birthdayCard`); }
                                else { cardBodyDiv = $(`#${entityId}workCard`); }
                                 //cardBody[0].children[0];
                                cardBodyDiv.append(comment);
                                //comment[0].show('slow');
                                //comment.get(0).hide().appendTo(cardBodyDiv).show('slow');
                            },
                            error: function () {
                                commentField.val('There was an error !');
                                commentField.blur();
                            }
                        });
                    }
                }
            });
        }

        function createNewComment(profileImage, firstName, lastName, created, content) {
            var str = `<div>
                           <hr />
                           <div class="d-flex flex-row pb-3 pt-2  border-top-0 border-left-0 border-right-0" style="margin-left: 2.5rem;">
                               <div class="d-inline-block align-middle status status-success mr-3">
                                   <span class="profile-image rounded-circle d-block" style="background-image:url('${profileImage}'); background-size: cover;"></span>
                               </div>
                               <h6 class="mb-0 flex-1 text-dark fw-500">
                                   @*style="flex: none;"*@
                                   ${firstName} ${lastName}
                               </h6>
                               <span class="text-muted fs-xs opacity-70" style="margin-left: 6.5rem;">${created}</span>
                           </div>
                           <span style="margin-left: 2.5rem;">${content}</span>
                       </div>`
            var commentEl = $.parseHTML(str);
            return commentEl;
        }

        function showAllCommentsForEntity(entityId, IsBirthday) {
            var hiddenDiv = null;
            if (IsBirthday) { hiddenDiv = $(`#${entityId}hiddenBirthdayCommentsDiv`); }
            else { hiddenDiv = $(`#${entityId}hiddenWorkCommentsDiv`); }

            hiddenDiv.slideToggle();
        }

    </script>
}
